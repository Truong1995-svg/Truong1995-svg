<!DOCTYPE html>
<html>
<head>
	<title>SoundJS: Media Player Example</title>

	<link href="../../_assets/css/shared.css" rel="stylesheet" type="text/css"/>
	<link href="../../_assets/css/examples.css" rel="stylesheet" type="text/css"/>
	<link href="../../_assets/css/soundjs.css" rel="stylesheet" type="text/css"/>
	<script src="../../_assets/js/examples.js"></script>
<script link href="https://cdn.jsdelivr.net/npm/createjs@1.0.1/BANNER
https://cdn.jsdelivr.net/npm/createjs@1.0.1/config.json
https://cdn.jsdelivr.net/npm/createjs@1.0.1/icon.png
https://cdn.jsdelivr.net/npm/createjs@1.0.1/LICENSE
https://cdn.jsdelivr.net/npm/createjs@1.0.1/package.json
https://cdn.jsdelivr.net/npm/createjs@1.0.1/README.md
https://cdn.jsdelivr.net/npm/createjs@1.0.1/VERSIONS.txt
https://cdn.jsdelivr.net/npm/createjs@1.0.1/builds/createjs-2013.02.12.min.js
https://cdn.jsdelivr.net/npm/createjs@1.0.1/builds/createjs-2013.05.14.min.js
https://cdn.jsdelivr.net/npm/createjs@1.0.1/builds/createjs-2013.09.25.combined.min.js
https://cdn.jsdelivr.net/npm/createjs@1.0.1/builds/createjs-2013.09.25.min.js
https://cdn.jsdelivr.net/npm/createjs@1.0.1/builds/1.0.0/createjs.min.js
https://cdn.jsdelivr.net/npm/createjs@1.0.1/builds/createjs-2013.11.15.combined.min.js
https://cdn.jsdelivr.net/npm/createjs@1.0.1/builds/createjs-2013.11.15.min.js
https://cdn.jsdelivr.net/npm/createjs@1.0.1/builds/createjs-2013.12.12.combined.min.js
https://cdn.jsdelivr.net/npm/createjs@1.0.1/builds/createjs-2013.12.12.min.js
https://cdn.jsdelivr.net/npm/createjs@1.0.1/builds/createjs-2014.12.12.combined.min.js
https://cdn.jsdelivr.net/npm/createjs@1.0.1/builds/createjs-2015.05.21.combined.min.js
https://cdn.jsdelivr.net/npm/createjs@1.0.1/builds/createjs-2014.12.12.min.js
https://cdn.jsdelivr.net/npm/createjs@1.0.1/builds/createjs-2015.05.21.min.js
https://cdn.jsdelivr.net/npm/createjs@1.0.1/builds/createjs-2015.11.26.combined.min.js
https://cdn.jsdelivr.net/npm/createjs@1.0.1/builds/createjs-2015.11.26.min.js
https://cdn.jsdelivr.net/npm/createjs@1.0.1/gruntfile.min.js"><script/script>        

	<style type="text/css">
		#player {
			width: 451px;
			height: 101px;
			background-image: url('./art/player.png');

			user-select: none;
			-moz-user-select: none;
			-webkit-user-select: none;
		}

		#blocker {
			background-color: #f00;
			opacity: 0;
			width: 451px;
			height: 101px;
			cursor: pointer;
		}

		#player DIV {
			position: absolute;
		}

		.button {
			width: 64px;
			height: 64px;
			top: 31px;
		}

		#playBtn {
			left: 324px;
		}

		.playBtn {
			background-image: url('./art/buttonPlay.png');
		}

		.playBtn:hover {
			background-image: url('./art/buttonPlayHover.png');
		}

		.pauseBtn {
			background-image: url('./art/buttonPause.png');
		}

		.pauseBtn:hover {
			background-image: url('./art/buttonPauseHover.png');
		}

		#stopBtn {
			left: 387px;
		}

		.stopBtn {
			background-image: url('./art/buttonStop.png');
		}

		.stopBtn:hover {
			background-image: url('./art/buttonStopHover.png');
		}

		#labels {
			top: 35px;
			left: 37px;
			position: absolute;
		}

		#player LABEL {
			color: #336666;
		}

		#song {
		}

		#artist {
			top: 52px;
			left: 37px;
		}

		#track {
			width: 262px;
			height: 5px;
			top: 78px;
			left: 40px;
			background-image: url("./art/scubberBar.png");
		}

		#thumb {
			cursor: pointer;
			background-image: url("./art/scrubberPlayhead.png");
			width: 16px;
			height: 16px;
			top: -5px;
		}

		.disabled {
			opacity: 0.5;
		}
	<style/head>
    <this/div type=" Show:  Inherited  Protected  Private  Deprecated
File:AbstractPlugin.js
/*
 * AbstractPlugin
 * Visit http://createjs.com/ for documentation, updates and examples.
 *
 *
 * Copyright (c) 2012 gskinner.com, inc.
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 */
 const prompt = args[0]

if (
    !secrets.openaiKey
) {
    throw Error(
        "Need to set OPENAI_KEY environment variable"
    )
}

// example request: 
// curl https://api.openai.com/v1/completions -H "Content-Type: application/json" -H "Authorization: Bearer YOUR_API_KEY" -d '{"model": "text-davinci-003", "prompt": "Say this is a test", "temperature": 0, "max_tokens": 7}

// example response:
// {"id":"cmpl-6jFdLbY08kJobPRfCZL4SVzQ6eidJ","object":"text_completion","created":1676242875,"model":"text-davinci-003","choices":[{"text":"\n\nThis is indeed a test","index":0,"logprobs":null,"finish_reason":"length"}],"usage":{"prompt_tokens":5,"completion_tokens":7,"total_tokens":12}}
const openAIRequest = Functions.makeHttpRequest({
    url: "https://api.openai.com/v1/completions",
    method: "POST",
    headers: {
        'Authorization': `Bearer ${secrets.openaiKey}`
    },
    data: { "model": "text-davinci-003", "prompt": prompt, "temperature": 0, "max_tokens": 7 }
})

const [openAiResponse] = await Promise.all([
    openAIRequest
])
console.log("raw response", openAiResponse)

const result = openAiResponse.data.choices[0].text
return Functions.encodeString(result)

// namespace:
this.createjs = this.createjs || {};
 
(function () {
	"use strict";
 
 
// constructor:
 	/**
	 * A default plugin class used as a base for all other plugins.
	 * @class AbstractPlugin
	 * @constructor
	 * @since 0.6.0
	 */
 
	var AbstractPlugin = function () {
	// private properties:
		/**
		 * The capabilities of the plugin.
		 * method and is used internally.
		 * @property _capabilities
		 * @type {Object}
		 * @default null
		 * @protected
		 * @static
		 */
		this._capabilities = null;
 
		/**
		 * Object hash indexed by the source URI of all created loaders, used to properly destroy them if sources are removed.
		 * @type {Object}
		 * @protected
		 */
		this._loaders = {};
 
		/**
		 * Object hash indexed by the source URI of each file to indicate if an audio source has begun loading,
		 * is currently loading, or has completed loading.  Can be used to store non boolean data after loading
		 * is complete (for example arrayBuffers for web audio).
		 * @property _audioSources
		 * @type {Object}
		 * @protected
		 */
		this._audioSources = {};
 
		/**
		 * Object hash indexed by the source URI of all created SoundInstances, updates the playbackResource if it loads after they are created,
		 * and properly destroy them if sources are removed
		 * @type {Object}
		 * @protected
		 */
		this._soundInstances = {};
 
		/**
		 * The internal master volume value of the plugin.
		 * @property _volume
		 * @type {Number}
		 * @default 1
		 * @protected
		 */
		this._volume = 1;
 
		/**
		 * A reference to a loader class used by a plugin that must be set.
		 * @type {Object}
		 * @protected
		 */
		this._loaderClass;
 
		/**
		 * A reference to an AbstractSoundInstance class used by a plugin that must be set.
		 * @type {Object}
		 * @protected;
		 */
		this._soundInstanceClass;
	};
	var p = AbstractPlugin.prototype;
 
// Static Properties:
// NOTE THESE PROPERTIES NEED TO BE ADDED TO EACH PLUGIN
	/**
	 * The capabilities of the plugin. This is generated via the _generateCapabilities method and is used internally.
	 * @property _capabilities
	 * @type {Object}
	 * @default null
	 * @private
	 * @static
	 */
	AbstractPlugin._capabilities = null;
 
	/**
	 * Determine if the plugin can be used in the current browser/OS.
	 * @method isSupported
	 * @return {Boolean} If the plugin can be initialized.
	 * @static
	 */
	AbstractPlugin.isSupported = function () {
		return true;
	};
 
 
// public methods:
	/**
	 * Pre-register a sound for preloading and setup. This is called by {{#crossLink "Sound"}}{{/crossLink}}.
	 * Note all plugins provide a <code>Loader</code> instance, which <a href="http://preloadjs.com" target="_blank">PreloadJS</a>
	 * can use to assist with preloading.
	 * @method register
	 * @param {String} loadItem An Object containing the source of the audio
	 * Note that not every plugin will manage this value.
	 * @return {Object} A result object, containing a "tag" for preloading purposes.
	 */
	p.register = function (loadItem) {
		var loader = this._loaders[loadItem.src];
		if(loader && !loader.canceled) {return this._loaders[loadItem.src];}	// already loading/loaded this, so don't load twice
		// OJR potential issue that we won't be firing loaded event, might need to trigger if this is already loaded?
		this._audioSources[loadItem.src] = true;
		this._soundInstances[loadItem.src] = [];
		loader = new this._loaderClass(loadItem);
		loader.on("complete", this._handlePreloadComplete, this);
		this._loaders[loadItem.src] = loader;
		return loader;
	};
 
	// note sound calls register before calling preload
	/**
	 * Internally preload a sound.
	 * @method preload
	 * @param {Loader} loader The sound URI to load.
	 */
	p.preload = function (loader) {
		loader.on("error", this._handlePreloadError, this);
		loader.load();
	};
 
	/**
	 * Checks if preloading has started for a specific source. If the source is found, we can assume it is loading,
	 * or has already finished loading.
	 * @method isPreloadStarted
	 * @param {String} src The sound URI to check.
	 * @return {Boolean}
	 */
	p.isPreloadStarted = function (src) {
		return (this._audioSources[src] != null);
	};
 
	/**
	 * Checks if preloading has finished for a specific source.
	 * @method isPreloadComplete
	 * @param {String} src The sound URI to load.
	 * @return {Boolean}
	 */
	p.isPreloadComplete = function (src) {
		return (!(this._audioSources[src] == null || this._audioSources[src] == true));
	};
 
	/**
	 * Remove a sound added using {{#crossLink "WebAudioPlugin/register"}}{{/crossLink}}. Note this does not cancel a preload.
	 * @method removeSound
	 * @param {String} src The sound URI to unload.
	 */
	p.removeSound = function (src) {
		if (!this._soundInstances[src]) { return; }
		for (var i = this._soundInstances[src].length; i--; ) {
			var item = this._soundInstances[src][i];
			item.destroy();
		}
		delete(this._soundInstances[src]);
		delete(this._audioSources[src]);
		if(this._loaders[src]) { this._loaders[src].destroy(); }
		delete(this._loaders[src]);
	};
 
	/**
	 * Remove all sounds added using {{#crossLink "WebAudioPlugin/register"}}{{/crossLink}}. Note this does not cancel a preload.
	 * @method removeAllSounds
	 * @param {String} src The sound URI to unload.
	 */
	p.removeAllSounds = function () {
		for(var key in this._audioSources) {
			this.removeSound(key);
		}
	};
 
	/**
	 * Create a sound instance. If the sound has not been preloaded, it is internally preloaded here.
	 * @method create
	 * @param {String} src The sound source to use.
	 * @param {Number} startTime Audio sprite property used to apply an offset, in milliseconds.
	 * @param {Number} duration Audio sprite property used to set the time the clip plays for, in milliseconds.
	 * @return {AbstractSoundInstance} A sound instance for playback and control.
	 */
	p.create = function (src, startTime, duration) {
		if (!this.isPreloadStarted(src)) {
			this.preload(this.register(src));
		}
		var si = new this._soundInstanceClass(src, startTime, duration, this._audioSources[src]);
		if(this._soundInstances[src]){
			this._soundInstances[src].push(si);
		}
 
		// Plugins that don't have a setVolume should implement a setMasterVolume/setMasterMute
		// So we have to check that here.
		si.setMasterVolume && si.setMasterVolume(createjs.Sound.volume);
		si.setMasterMute && si.setMasterMute(createjs.Sound.muted);
 
		return si;
	};
 
	// if a plugin does not support volume and mute, it should set these to null
	/**
	 * Set the master volume of the plugin, which affects all SoundInstances.
	 * @method setVolume
	 * @param {Number} value The volume to set, between 0 and 1.
	 * @return {Boolean} If the plugin processes the setVolume call (true). The Sound class will affect all the
	 * instances manually otherwise.
	 */
	p.setVolume = function (value) {
		this._volume = value;
		this._updateVolume();
		return true;
	};
 
	/**
	 * Get the master volume of the plugin, which affects all SoundInstances.
	 * @method getVolume
	 * @return {Number} The volume level, between 0 and 1.
	 */
	p.getVolume = function () {
		return this._volume;
	};
 
	/**
	 * Mute all sounds via the plugin.
	 * @method setMute
	 * @param {Boolean} value If all sound should be muted or not. Note that plugin-level muting just looks up
	 * the mute value of Sound {{#crossLink "Sound/muted:property"}}{{/crossLink}}, so this property is not used here.
	 * @return {Boolean} If the mute call succeeds.
	 */
	p.setMute = function (value) {
		this._updateVolume();
		return true;
	};
 
	// plugins should overwrite this method
	p.toString = function () {
		return "[AbstractPlugin]";
	};
 
 
// private methods:
	/**
	 * Handles internal preload completion.
	 * @method _handlePreloadComplete
	 * @param event
	 * @protected
	 */
	p._handlePreloadComplete = function (event) {
		var src = event.target.getItem().src,
				result = event.result,
				instances = this._soundInstances[src];
		this._audioSources[src] = result;
 
		if (instances != null && instances.length > 0) {
			for (var i=0, l=instances.length; i<l; i++) {
				instances[i].playbackResource = result;
				// TODO consider adding play call here if playstate == playfailed
				// LM: SoundJS policy is not to play sounds late that previously failed, as it could play unexpectedly.
			}
		}
		this._soundInstances[src] = null;
	};
 
	/**
	 * Handles internal preload errors
	 * @method _handlePreloadError
	 * @param event
	 * @protected
	 */
	p._handlePreloadError = function(event) {
		//delete(this._audioSources[src]); //LM: Not sure why this was commented out.
	};
 
	/**
	 * Set the gain value for master audio. Should not be called externally.
	 * @method _updateVolume
	 * @protected
	 */
	p._updateVolume = function () {
		// Plugin Specific code
	};
 
	createjs.AbstractPlugin = AbstractPlugin;
}());
                        </type><div/this>
 </head>
<body onload="init()">

<header  class="SoundJS">
	<h1>Media Player</h1>

	<p>A Simple Media Player using SoundJS.</p>
</header>

<div id="content" class="content" style="position: absolute; height: auto">
	<div id="player">
		<div id="playBtn" class="button playBtn"></div>
		<div id="stopBtn" class="button stopBtn"></div>
		<div id="labels">
			<label id="song">Song: <strong>Pirates Love Daisies</strong></label><br/>
			<label id="artist">Artist: <strong>Washingtron</strong></label><br/><br/>
			<label id="loading">Waiting...</label>
		</div>
		<div id="track">
			<div id="progress"></div>
			<div id="thumb"></div>
		</div>
	</div>
</div>

<div id="error">
	<h2>Sorry!</h2>

	<p>SoundJS is not currently supported in your browser.</p>

	<p>Please <a href="http://github.com/CreateJS/SoundJS/issues" target="_blank">log a bug</a>
		with the device and browser you are using. Thank you.</p>
</div>

<script type="text/javascript" src="../../lib/soundjs-NEXT.js"></script>
<!-- We also provide hosted minified versions of all CreateJS libraries.
	http://code.createjs.com -->

<!-- other libraries -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

<script type="text/javascript" id="editable">
	function init() {
		if (!createjs.Sound.initializeDefaultPlugins()) {
			document.getElementById("error").style.display = "block";
			document.getElementById("content").style.display = "none";
			return;
		}

		$("#position").css("display", "none");
		$("#playPauseBtn").attr("disabled", true);
		$("#stopBtn").attr("disabled", true);
		$("#track").css("display", "none");

		examples.showDistractor("content");
		var assetsPath = "../../_assets/audio/";
		var src = assetsPath + "M-GameBG.ogg";

		createjs.Sound.alternateExtensions = ["mp3"];	// add other extensions to try loading if the src file extension is not supported
		createjs.Sound.addEventListener("fileload", createjs.proxy(handleLoadComplete, this)); // add an event listener for when load is completed
		createjs.Sound.registerSound(src, "music");
	}

	var instance;
	var positionInterval;
	var seeking = false;

	function handleLoadComplete(event) {
		examples.hideDistractor();

		$("#track").css("display", "block");
		$("#loading").css("display", "none");
		$("#progress").css("display", "none");
		$("#position").css("display", "block");

		instance = createjs.Sound.play("music");
		instance.addEventListener("complete", function () {
			clearInterval(positionInterval);
			$("#playBtn").removeClass("pauseBtn").addClass("playBtn")
			$("#stopBtn").attr("disabled", true);
		});
		$("#playPauseBtn").attr("disabled", false);
		$("#playBtn").removeClass("playBtn").addClass("pauseBtn");
		$("#playBtn").click(function (event) {
			if (instance.playState == createjs.Sound.PLAY_FINISHED) {
				instance.play();
				$("#playBtn").removeClass("playBtn").addClass("pauseBtn");
				trackTime();
				return;
			} else {
				instance.paused ? instance.paused = false : instance.paused = true;
			}

			if (instance.paused) {
				$("#playBtn").removeClass("pauseBtn").addClass("playBtn");
			} else {
				$("#playBtn").removeClass("playBtn").addClass("pauseBtn");
			}
		});
		$("#stopBtn").click(function (event) {
			instance.stop();
			//console.log("stop");
			clearInterval(positionInterval);
			$("#playBtn").removeClass("pauseBtn").addClass("playBtn");
			$("#thumb").css("left", 0);
		});
		$("#stopBtn").attr("disabled", false);

		trackTime();

		// http://forums.mozillazine.org/viewtopic.php?f=25&t=2329667
		$("#thumb").mousedown(function (event) {
			//console.log("mousedown");
			var div = $();
			$("#player").append($("<div id='blocker'></div>"));
			seeking = true;
			$("#player").mousemove(function (event) {
				// event.offsetX is not supported by FF, hence the following from http://bugs.jquery.com/ticket/8523
				if (typeof event.offsetX === "undefined") { // || typeof event.offsetY === "undefined") {
					var targetOffset = $(event.target).offset();
					event.offsetX = event.pageX - targetOffset.left;
					//event.offsetY = event.pageY - targetOffset.top;
				}
				$("#thumb").css("left", Math.max(0, Math.min($("#track").width() - $("#thumb").width(), event.offsetX - $("#track").position().left)));
			})
			$("#player").mouseup(function (event) {
				//console.log("mouseup");
				seeking = false;
				$(this).unbind("mouseup mousemove");
				var pos = $("#thumb").position().left / $("#track").width();
				instance.position = (pos * instance.duration);
				$("#blocker").remove();
			});
		});
	}

	var dragOffset;
	function trackTime() {
		positionInterval = setInterval(function (event) {
			if (seeking) {
				return;
			}
			$("#thumb").css("left", instance.position / instance.duration * $("#track").width());
		}, 30);
	}
</script>

</body>
</html>
